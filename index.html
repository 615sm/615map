<!DOCTYPE html>
<html lang="ja">
<head>
    <title>ãƒ‡ãƒ¼ã‚¿å¾©æ—§ä¸­ï¼ˆ615å°‚ç”¨ï¼‰</title>
    <meta charset="utf-8" />
    <style>
        body { padding: 40px; font-family: sans-serif; text-align: center; line-height: 1.6; }
        #status { font-size: 24px; font-weight: bold; color: #2196F3; }
        #log { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin-top: 20px; text-align: left; height: 150px; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="status">ğŸ”„ å¾©å…ƒã‚’é–‹å§‹ã—ã¾ã™...</div>
    <h2 id="counter">0ä»¶ å®Œäº†</h2>
    <div id="log"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCT1QoYP3SxIOjFOrWdZWBg7akzYzcijL0",
            authDomain: "tankyuu-89580.firebaseapp.com",
            projectId: "tankyuu-89580",
            storageBucket: "tankyuu-89580.firebasestorage.app",
            messagingSenderId: "88004060927",
            appId: "1:88004060927:web:0cbb798daf727883a38eca"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function recover() {
            const logEl = document.getElementById('log');
            const targetFile = '615ã€€ (2).kml'; // ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã®æ­£ç¢ºãªãƒ•ã‚¡ã‚¤ãƒ«å
            
            logEl.innerHTML += `${targetFile} ã‚’èª­ã¿è¾¼ã¿ä¸­...<br>`;
            
            try {
                const res = await fetch(targetFile);
                if (!res.ok) throw new Error("ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚GitHubã«åŒåã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                
                const text = await res.text();
                const kml = new DOMParser().parseFromString(text, "text/xml");
                const placemarks = kml.getElementsByTagName("Placemark");
                
                logEl.innerHTML += `${placemarks.length}ä»¶ã®ãƒ”ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚Firebaseã«ä¿å­˜ä¸­...<br>`;

                let count = 0;
                for (let p of placemarks) {
                    const coords = p.querySelector("coordinates")?.textContent.trim().split(",");
                    if (coords) {
                        await db.collection("bins").add({
                            lat: parseFloat(coords[1]),
                            lng: parseFloat(coords[0]),
                            name: p.querySelector("name")?.textContent || "ãƒã‚¤ãƒ³ãƒˆ",
                            memo: p.querySelector("description")?.textContent || "",
                            tag: "å¾©æ—§ãƒ‡ãƒ¼ã‚¿"
                        });
                        count++;
                        document.getElementById('counter').innerText = `${count}ä»¶ å®Œäº†`;
                    }
                }
                
                document.getElementById('status').innerText = "âœ… å¾©å…ƒæˆåŠŸï¼";
                document.getElementById('status').style.color = "green";
                logEl.innerHTML += "<b>ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚ã‚‚ã†ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ã€Œå®Œå…¨ç‰ˆã€ã«æ›¸ãæ›ãˆã¦å¤§ä¸ˆå¤«ã§ã™ï¼</b>";
                
            } catch (e) {
                document.getElementById('status').innerText = "âŒ å¤±æ•—";
                logEl.innerHTML += `ã‚¨ãƒ©ãƒ¼: ${e.message}<br>`;
            }
        }
        recover();
    </script>
</body>
</html>
